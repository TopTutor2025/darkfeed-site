<!doctype html>
<html lang="it">
<head>
  <!-- =========================
       SEO / META
  ========================== -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>Dark Feed — Analisi Geopolitiche, Finanziarie, Tecnologiche, Politiche</title>
  <meta name="description" content="Dark Feed: analisi e approfondimenti geopolitici, finanziari, tecnologici e politici in stile dark, feed X-like con accenti cyberpunk." />
  <meta name="robots" content="index,follow" />

  <!-- Dominio ufficiale -->
  <link rel="canonical" href="https://darkfeed.online/" />
  <meta name="theme-color" content="#0a0b10" />

  <!-- Open Graph -->
  <meta property="og:title" content="Dark Feed" />
  <meta property="og:description" content="Analisi e aggiornamenti geopolitici, finanziari, tecnologici e politici in stile dark." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://darkfeed.online/" />
  <meta property="og:image" content="https://darkfeed.online/assets/og-dark-feed.jpg" />
  <meta property="og:image:alt" content="Dark Feed — Analisi Geopolitiche, Finanziarie, Tecnologiche, Politiche" />
  <meta property="og:locale" content="it_IT" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Dark Feed" />
  <meta name="twitter:description" content="Analisi e aggiornamenti geopolitici, finanziari, tecnologici e politici in stile dark." />
  <meta name="twitter:image" content="https://darkfeed.online/assets/og-dark-feed.jpg" />

  <!-- JSON-LD (base) -->
  <!-- Nota: omesso SearchAction perché la ricerca è client-side e non usa ?q= -->
  <script type="application/ld+json">
  {
    "@context":"https://darkfeed.online",
    "@type":"WebSite",
    "name":"Dark Feed",
    "url":"https://darkfeed.online/"
  }
  </script>

  <style>
    :root{
      --bg: #0a0b10;
      --panel: rgba(15,18,32,0.60);
      --text: #e8ecff;
      --muted: #a7b0d6;
      --muted-2: #7d86ad;

      --neon-cyan: #00f5ff;
      --neon-magenta: #ff2bd6;
      --neon-yellow: #ffd200;
      --neon-green: #38ff7b;

      --shadow: 0 18px 40px rgba(0,0,0,.55);
      --radius: 18px;

      --max: 1200px;
      --nav-h: 68px;

      /* Bottom bar (mobile only) */
      --bottombar-h: 62px;

      /* Cookie safe spacing when banner open */
      --cookie-safe: 0px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 700px at 20% -10%, rgba(0,245,255,.10), transparent 55%),
        radial-gradient(900px 600px at 95% 10%, rgba(255,43,214,.10), transparent 55%),
        radial-gradient(900px 700px at 30% 110%, rgba(255,210,0,.08), transparent 60%),
        var(--bg);
      color:var(--text);
      font: 15px/1.55 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      overflow-x:hidden;
    }
    a{color:inherit; text-decoration:none}
    a:hover{opacity:.92}

    /* =========================
       TOP NAVBAR
    ========================== */
    .nav-wrap{
      position:fixed;
      top:0; left:0; right:0;
      z-index:1000;
      height:var(--nav-h);
      display:flex;
      align-items:center;
      justify-content:center;
      transition: transform .28s ease, background-color .25s ease, backdrop-filter .25s ease, border-color .25s ease;
      transform: translateY(0);
      background: rgba(10,11,16,0.92);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(180,195,255,0.10);
    }
    .nav-wrap.is-scrolled{ background: rgba(10,11,16,0.60); }
    .nav-wrap.is-hidden{ transform: translateY(-110%); }

    .nav{
      width:min(var(--max), calc(100% - 28px));
      display:grid;
      grid-template-columns: 1fr auto 1fr; /* Desktop: brand | cats | right */
      align-items:center;
      gap:12px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 180px;
    }
    .brand img{
      width:34px; height:34px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 0 0 1px rgba(0,245,255,.15), 0 0 18px rgba(0,245,255,.10);
      object-fit:cover;
    }
    .brand .name{
      font-weight:800;
      letter-spacing:.35px;
      font-size:16px;
      display:flex;
      align-items:baseline;
      gap:6px;
      white-space:nowrap;
    }
    .brand .name .dot{
      width:8px; height:8px; border-radius:99px;
      background: var(--neon-magenta);
      box-shadow: 0 0 12px rgba(255,43,214,.55);
      display:inline-block;
    }
    .brand .sub{
      color:var(--muted-2);
      font-size:12px;
      line-height:1.1;
      margin-top:2px;
    }

    .cats{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      flex-wrap:wrap; /* Desktop ok */
    }
    .cat-btn{
      border:1px solid rgba(180,195,255,0.14);
      background: rgba(15,18,32,0.75);
      color: var(--text);
      padding:8px 10px;
      border-radius: 999px;
      font-weight:700;
      font-size:13px;
      cursor:pointer;
      transition: transform .12s ease, border-color .2s ease, box-shadow .2s ease;
      display:flex;
      align-items:center;
      gap:8px;
      user-select:none;
      white-space:nowrap;
    }
    .cat-btn:hover{
      border-color: rgba(0,245,255,0.35);
      box-shadow: 0 0 0 1px rgba(0,245,255,0.15), 0 0 20px rgba(0,245,255,0.08);
      transform: translateY(-1px);
    }
    .cat-btn.is-active{
      border-color: rgba(255,43,214,0.55);
      box-shadow: 0 0 0 1px rgba(255,43,214,0.20), 0 0 22px rgba(255,43,214,0.10);
    }
    .cat-pill{width:10px;height:10px;border-radius:99px;display:inline-block;background:var(--neon-cyan);box-shadow:0 0 10px rgba(0,245,255,.45)}
    .cat-pill.fin{background: var(--neon-yellow); box-shadow:0 0 10px rgba(255,210,0,.35)}
    .cat-pill.tech{background: var(--neon-cyan); box-shadow:0 0 10px rgba(0,245,255,.45)}
    .cat-pill.pol{background: var(--neon-magenta); box-shadow:0 0 10px rgba(255,43,214,.45)}
    .cat-pill.geo{background: var(--neon-green); box-shadow:0 0 10px rgba(56,255,123,.40)}

    .nav-right{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap:10px;
      min-width: 260px;
    }
    .search{
      position:relative;
      width:min(320px, 100%);
    }
    .search input{
      width:100%;
      padding:10px 12px 10px 38px;
      border-radius: 999px;
      border:1px solid rgba(180,195,255,0.14);
      background: rgba(10,11,16,0.40);
      color: var(--text);
      outline:none;
      transition:border-color .2s ease, box-shadow .2s ease;
    }
    .search input:focus{
      border-color: rgba(0,245,255,0.40);
      box-shadow: 0 0 0 1px rgba(0,245,255,0.18), 0 0 26px rgba(0,245,255,0.10);
    }
    .search .icon{
      position:absolute; left:12px; top:50%;
      transform: translateY(-50%);
      opacity:.85; color: var(--muted);
      font-size:14px; pointer-events:none;
    }

    .patreon{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,66,77,0.18);
      color: var(--text);
      font-weight:800;
      font-size:13px;
      box-shadow: 0 0 0 1px rgba(255,66,77,0.12), 0 0 26px rgba(255,66,77,0.08);
      transition: transform .12s ease, opacity .12s ease;
      white-space:nowrap;
    }
    .patreon:hover{transform: translateY(-1px)}
    .p-dot{
      width:12px; height:12px; border-radius:99px;
      background:#ff424d;
      box-shadow: 0 0 18px rgba(255,66,77,.25);
      display:inline-block;
    }

    /* =========================
       PAGE
    ========================== */
    .page{
      width:min(var(--max), calc(100% - 28px));
      margin:0 auto;
      padding-top: calc(var(--nav-h) + 14px);
      padding-bottom: calc(60px + var(--cookie-safe));
    }

    /* Status banner */
    .status{
      margin-top:14px;
      border-radius: 14px;
      border:1px solid rgba(255,43,214,0.22);
      background: rgba(255,43,214,0.08);
      padding:10px 12px;
      color: var(--text);
      font-weight:800;
      display:none;
    }

    /* =========================
       BREAKING STRIP
    ========================== */
    .breaking{
      margin-top: 10px;
      background: linear-gradient(90deg, rgba(0,245,255,.08), rgba(255,43,214,.08));
      border:1px solid rgba(180,195,255,0.12);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .breaking-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 14px;
      border-bottom: 1px solid rgba(180,195,255,0.10);
      background: rgba(15,18,32,0.55);
    }
    .breaking-title{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:900;
      letter-spacing:.3px;
    }
    .pulse{
      width:10px; height:10px; border-radius:99px;
      background: var(--neon-yellow);
      box-shadow: 0 0 16px rgba(255,210,0,.35);
      position:relative;
    }
    .pulse:after{
      content:"";
      position:absolute;
      inset:-8px;
      border-radius:999px;
      border:1px solid rgba(255,210,0,.35);
      animation: pulse 1.8s ease-in-out infinite;
      opacity:.75;
    }
    @keyframes pulse{
      0%{transform:scale(.6); opacity:.70}
      70%{transform:scale(1.2); opacity:0}
      100%{transform:scale(1.2); opacity:0}
    }
    .breaking-hint{color: var(--muted-2); font-size:12px}
    .breaking-rail{
      display:flex;
      gap:12px;
      padding:12px 14px;
      overflow:auto;
      scroll-snap-type:x mandatory;
      -webkit-overflow-scrolling: touch;
    }
    .breaking-rail::-webkit-scrollbar{height:10px}
    .breaking-rail::-webkit-scrollbar-thumb{background: rgba(180,195,255,0.16); border-radius:999px}
    .breaking-item{
      min-width: 260px;
      max-width: 360px;
      scroll-snap-align:start;
      border-radius: 14px;
      border:1px solid rgba(180,195,255,0.12);
      background: rgba(10,11,16,0.55);
      padding:10px 12px;
      box-shadow: 0 0 0 1px rgba(0,245,255,0.06);
    }
    .breaking-time{
      color: var(--neon-cyan);
      font-weight:900;
      font-size:12px;
      letter-spacing:.4px;
      margin-bottom:6px;
    }
    .breaking-text{
      color: var(--text);
      font-weight:700;
      font-size:13px;
      line-height:1.35;
    }

    /* =========================
       MAIN LAYOUT (DESKTOP)
    ========================== */
    .main{
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:16px;
      margin-top: 14px;
      align-items:start;
    }

    .feed{display:flex;flex-direction:column;gap:14px}

    .card{
      border-radius: var(--radius);
      border:1px solid rgba(180,195,255,0.12);
      background: var(--panel);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .card:before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        radial-gradient(900px 250px at 10% 0%, rgba(0,245,255,.10), transparent 55%),
        radial-gradient(700px 220px at 95% 20%, rgba(255,43,214,.08), transparent 55%);
      opacity:.9;
    }
    .card > *{position:relative}

    .card-head{
      padding:14px 14px 10px;
      border-bottom: 1px solid rgba(180,195,255,0.10);
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .meta-left{min-width:0}
    .title{font-size:18px;line-height:1.25;font-weight:950;letter-spacing:.2px;margin:0 0 8px}
    .sub{margin:0;color: var(--muted);font-weight:650;font-size:13px;line-height:1.35}
    .meta-right{text-align:right;flex:0 0 auto;color: var(--muted-2);font-size:12px;font-weight:800;white-space:nowrap;padding-top:2px}

    .tags{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .tag{
      font-size:12px;font-weight:900;letter-spacing:.3px;
      padding:6px 10px;border-radius: 999px;border:1px solid rgba(180,195,255,0.14);
      background: rgba(10,11,16,0.45);
      display:inline-flex;align-items:center;gap:8px;color: var(--text);
    }
    .tag .mini{width:8px;height:8px;border-radius:99px;background: var(--neon-cyan);box-shadow: 0 0 10px rgba(0,245,255,.35)}
    .tag.geo .mini{background: var(--neon-green); box-shadow: 0 0 10px rgba(56,255,123,.28)}
    .tag.fin .mini{background: var(--neon-yellow); box-shadow: 0 0 10px rgba(255,210,0,.25)}
    .tag.tech .mini{background: var(--neon-cyan); box-shadow: 0 0 10px rgba(0,245,255,.35)}
    .tag.pol .mini{background: var(--neon-magenta); box-shadow: 0 0 10px rgba(255,43,214,.30)}

    .media{width:100%;background: rgba(10,11,16,0.55);border-bottom: 1px solid rgba(180,195,255,0.10)}
    .media img{width:100%;display:block;max-height:360px;object-fit:cover;filter: contrast(1.04) saturate(1.05)}
    .yt{position:relative;width:100%;aspect-ratio:16/9;background: rgba(10,11,16,0.75)}
    .yt iframe{position:absolute;inset:0;width:100%;height:100%;border:0}

    .card-body{padding: 12px 14px 14px}
    .body{color: var(--text);font-size:14px;line-height:1.65;margin:0 0 12px}

    .quote{
      margin: 12px 0 10px;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,210,0,0.22);
      background: rgba(255,210,0,0.08);
      position:relative;
      overflow:hidden;
    }
    .quote:before{
      content:"";
      position:absolute;inset:0;
      background:
        radial-gradient(650px 240px at 0% 0%, rgba(255,210,0,.12), transparent 60%),
        radial-gradient(600px 200px at 100% 50%, rgba(0,245,255,.08), transparent 55%);
      opacity:.9;pointer-events:none;
    }
    .quote > *{position:relative}
    .quote .label{font-weight:950;letter-spacing:.3px;font-size:12px;color: var(--neon-yellow);margin-bottom:6px;text-transform:uppercase}
    .quote .text{margin:0;color: var(--text);font-weight:700;font-size:13px;line-height:1.5}

    .sources{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
    .source{
      border:1px solid rgba(180,195,255,0.14);
      background: rgba(10,11,16,0.45);
      padding:8px 10px;border-radius: 999px;
      font-size:12px;font-weight:850;color: var(--muted);
      transition: border-color .2s ease, box-shadow .2s ease, transform .12s ease;
    }
    .source:hover{
      border-color: rgba(0,245,255,0.35);
      box-shadow: 0 0 0 1px rgba(0,245,255,0.14), 0 0 20px rgba(0,245,255,0.08);
      transform: translateY(-1px);
      color: var(--text);
    }

    /* Sidebar (Desktop) */
    .sidebar{
      position:sticky;
      top: calc(var(--nav-h) + 16px);
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .side-card{
      border-radius: var(--radius);
      border:1px solid rgba(180,195,255,0.12);
      background: var(--panel);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .side-card:before{
      content:"";
      position:absolute;inset:0;pointer-events:none;
      background:
        radial-gradient(700px 240px at 10% 0%, rgba(255,43,214,.10), transparent 55%),
        radial-gradient(700px 240px at 95% 30%, rgba(0,245,255,.08), transparent 55%);
      opacity:.9;
    }
    .side-card > *{position:relative}
    .side-head{
      padding: 12px 14px;
      border-bottom: 1px solid rgba(180,195,255,0.10);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .side-head h3{margin:0;font-size:14px;font-weight:950;letter-spacing:.35px}
    .side-badge{
      font-size:11px;font-weight:950;padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,43,214,.30);
      background: rgba(255,43,214,.10);
      color: var(--text);
      letter-spacing:.3px;
      white-space:nowrap;
    }
    .featured-list{display:flex;flex-direction:column;gap:10px;padding: 12px 14px 14px}

    .feat-item{
      display:grid;grid-template-columns: 86px 1fr;gap:10px;align-items:start;
      border:1px solid rgba(180,195,255,0.10);
      border-radius: 14px;
      background: rgba(10,11,16,0.45);
      overflow:hidden;
      transition: transform .12s ease, border-color .2s ease, box-shadow .2s ease;
      cursor:pointer;
    }
    .feat-item:hover{
      transform: translateY(-1px);
      border-color: rgba(0,245,255,0.30);
      box-shadow: 0 0 0 1px rgba(0,245,255,0.12), 0 0 18px rgba(0,245,255,0.07);
    }
    .feat-thumb{width:86px;height:60px;background: rgba(0,0,0,.35);display:block;object-fit:cover}
    .feat-meta{padding:8px 10px 8px 0;min-width:0}
    .feat-title{margin:0 0 4px;font-weight:950;font-size:13px;line-height:1.25;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .feat-sub{margin:0;color: var(--muted-2);font-weight:750;font-size:12px;line-height:1.25;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}

    /* Live updates (Desktop sidebar) */
    .updates{display:flex;flex-direction:column;gap:10px}
    .update-item{
      border:1px solid rgba(180,195,255,0.10);
      border-radius: 14px;
      background: rgba(10,11,16,0.45);
      padding:10px 10px;
      transition: border-color .2s ease, box-shadow .2s ease, transform .12s ease;
    }
    .update-item:hover{
      border-color: rgba(0,245,255,0.28);
      box-shadow: 0 0 0 1px rgba(0,245,255,0.10), 0 0 18px rgba(0,245,255,0.07);
      transform: translateY(-1px);
    }
    .update-head{
      display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:6px;
    }
    .update-user{display:flex;align-items:center;gap:10px;min-width:0;}
    .avatar{
      width:28px;height:28px;border-radius:10px;
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 0 0 1px rgba(0,245,255,.10), 0 0 14px rgba(0,245,255,.08);
      object-fit:cover; flex:0 0 auto;
    }
    .handle{
      font-weight:950;font-size:13px;letter-spacing:.2px;color: var(--text);
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .handle a{color: var(--neon-cyan); font-weight:950;}
    .update-time{color: var(--muted-2);font-size:12px;font-weight:850;white-space:nowrap;}
    .update-text{margin:0;color: var(--text);font-size:13px;line-height:1.45;font-weight:650;}
    .update-tags{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;}
    .mini-chip{
      font-size:11px;font-weight:950;letter-spacing:.25px;
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(180,195,255,0.12);
      background: rgba(15,18,32,0.55);
      color: var(--muted);
    }
    .mini-chip.live{
      border-color: rgba(255,210,0,0.28);
      background: rgba(255,210,0,0.08);
      color: var(--neon-yellow);
    }

    /* =========================
       FOOTER (desktop)
    ========================== */
    .site-footer{
      margin-top: 18px;
      border-radius: var(--radius);
      border:1px solid rgba(180,195,255,0.12);
      background: rgba(10,11,16,0.45);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .site-footer:before{
      content:"";
      position:absolute; inset:0; pointer-events:none;
      background:
        radial-gradient(900px 220px at 10% 0%, rgba(0,245,255,.10), transparent 55%),
        radial-gradient(900px 220px at 95% 40%, rgba(255,43,214,.08), transparent 55%);
      opacity:.9;
    }
    .site-footer > *{position:relative}

    .footer-inner{
      padding: 14px 14px;
      display:grid;
      grid-template-columns: 1.2fr 1fr 1fr;
      gap:14px;
      border-bottom: 1px solid rgba(180,195,255,0.10);
    }
    .footer-block h4{
      margin:0 0 8px;
      font-size:13px;
      font-weight:950;
      letter-spacing:.35px;
      color: var(--text);
    }
    .footer-block p{
      margin:0;
      color: var(--muted);
      font-size:12px;
      line-height:1.55;
      font-weight:650;
    }
    .footer-links{
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .footer-links a{
      display:inline-flex;
      gap:8px;
      align-items:center;
      color: var(--muted);
      font-size:12px;
      font-weight:850;
      padding:6px 8px;
      border-radius: 10px;
      border:1px solid rgba(180,195,255,0.10);
      background: rgba(15,18,32,0.45);
      width:max-content;
      transition: border-color .2s ease, box-shadow .2s ease, transform .12s ease;
    }
    .footer-links a:hover{
      color: var(--text);
      border-color: rgba(0,245,255,0.30);
      box-shadow: 0 0 0 1px rgba(0,245,255,0.12), 0 0 18px rgba(0,245,255,0.07);
      transform: translateY(-1px);
    }
    .footer-bottom{
      padding: 10px 14px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      color: var(--muted-2);
      font-size:12px;
      font-weight:750;
    }
    .footer-badges{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .footer-badge{
      font-size:11px;
      font-weight:950;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(180,195,255,0.12);
      background: rgba(15,18,32,0.55);
      color: var(--muted);
    }

    /* =========================
       MOBILE/TABLET LAYOUT
    ========================== */
    @media (max-width: 980px){
      .main{grid-template-columns: 1fr;}
      .sidebar{display:none;}
      .page{
        padding-bottom: calc(60px + var(--bottombar-h) + var(--cookie-safe));
      }
      .footer-inner{
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 700px){
      .nav{
        grid-template-columns: 1fr 1fr;
        grid-template-areas:
          "brand right"
          "cats cats";
        row-gap:10px;
      }
      .brand{grid-area:brand}
      .nav-right{grid-area:right; min-width:auto}
      .cats{
        grid-area:cats;
        justify-content:flex-start;
        flex-wrap:nowrap;
        overflow:auto;
        -webkit-overflow-scrolling:touch;
        margin-top: 10px;
        padding-bottom: 6px;
        margin-bottom: -6px;
        scroll-snap-type: x mandatory;
      }
      .cats::-webkit-scrollbar{height:10px}
      .cats::-webkit-scrollbar-thumb{background: rgba(180,195,255,0.16); border-radius:999px}
      .cat-btn{scroll-snap-align:start;flex:0 0 auto}

      .nav-wrap{height:auto; padding:10px 0}
      :root{--nav-h: 112px;}
    }

    @media (max-width: 560px){
      :root{--radius: 16px;}
      .nav-right .patreon{display:none;} /* Patreon desktop only: on mobile it is in bottom bar */
      .search{display:block; width:100%;}
      .brand .sub{display:none}
      .title{font-size:17px}
      .meta-right{font-size:11px}
      .breaking-item{min-width: 220px}

      /* Footer more compact on mobile */
      .site-footer{margin-top: 14px}
      .footer-inner{
        padding: 10px 10px;
        gap:10px;
      }
      .footer-block h4{margin:0 0 6px;font-size:12px}
      .footer-block p{font-size:12px}
      .footer-links{
        flex-direction:row;
        flex-wrap:wrap;
        gap:8px;
      }
      .footer-links a{
        padding:6px 8px;
        border-radius: 999px;
      }
      .footer-bottom{
        padding: 8px 10px;
        flex-direction:column;
        align-items:flex-start;
        gap:8px;
      }
      .footer-badge{
        padding:5px 8px;
        font-size:10px;
      }
    }

    @media (prefers-reduced-motion: reduce){
      *{transition:none !important; animation:none !important}
    }

    /* =========================
       BOTTOM BAR + SHEET (MOBILE ONLY)
    ========================== */
    .bottombar, .sheet-backdrop { display:none; }
    @media (max-width: 980px){
      .bottombar{ display:flex; }
      .sheet-backdrop{ display:none; }
    }

    .bottombar{
      position:fixed;
      left:0; right:0; bottom:0;
      height: var(--bottombar-h);
      z-index:1150;
      align-items:center;
      justify-content:center;
      transform: translateY(110%);
      opacity: 0;
      transition: transform .28s ease, opacity .28s ease;
      background: rgba(10,11,16,0.68);
      backdrop-filter: blur(14px);
      border-top: 1px solid rgba(180,195,255,0.10);
    }
    .bottombar.is-visible{ transform: translateY(0); opacity: 1; }
    .bottombar-inner{
      width:min(var(--max), calc(100% - 20px));
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    /* Patreon SLIM inside bottom bar (mobile) */
    .bb-patreon{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      height:32px;
      border-radius:999px;
      font-size:12px;
      font-weight:900;
      letter-spacing:.25px;
      color:var(--text);
      background:rgba(255,66,77,0.16);
      border:1px solid rgba(255,66,77,0.35);
      box-shadow:
        0 0 0 1px rgba(255,66,77,0.12),
        0 0 16px rgba(255,66,77,0.10);
      white-space:nowrap;
      transition:transform .12s ease, box-shadow .2s ease, border-color .2s ease;
      flex:0 0 auto;
    }
    .bb-patreon:hover{
      transform:translateY(-1px);
      border-color:rgba(255,66,77,0.55);
      box-shadow:
        0 0 0 1px rgba(255,66,77,0.20),
        0 0 22px rgba(255,66,77,0.18);
    }
    .bb-patreon .p-dot{
      width:8px;height:8px;border-radius:99px;
      background:#ff424d;
      box-shadow:0 0 10px rgba(255,66,77,.45);
      display:inline-block;
    }

    .bb-actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex:0 0 auto;
      min-width:0;
    }
    .bb-btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid rgba(180,195,255,0.14);
      background: rgba(15,18,32,0.70);
      color: var(--text);
      font-weight:900;
      font-size:13px;
      letter-spacing:.2px;
      cursor:pointer;
      transition: transform .12s ease, border-color .2s ease, box-shadow .2s ease;
      user-select:none;
      white-space:nowrap;
    }
    .bb-btn:hover{
      border-color: rgba(0,245,255,0.35);
      box-shadow: 0 0 0 1px rgba(0,245,255,0.14), 0 0 18px rgba(0,245,255,0.08);
      transform: translateY(-1px);
    }
    .bb-dot{
      width:10px; height:10px; border-radius:99px;
      display:inline-block;
      background: var(--neon-magenta);
      box-shadow: 0 0 10px rgba(255,43,214,.35);
    }
    .bb-dot.cyan{background: var(--neon-cyan); box-shadow:0 0 10px rgba(0,245,255,.35)}
    .bb-dot.yellow{background: var(--neon-yellow); box-shadow:0 0 10px rgba(255,210,0,.25)}

    /* Bottom sheet */
    .sheet-backdrop{
      position:fixed;
      inset:0;
      z-index:1300;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(6px);
    }
    .sheet-backdrop.is-open{ display:block; }
    .sheet{
      position:absolute;
      left:0; right:0; bottom:0;
      max-height: 78vh;
      transform: translateY(105%);
      transition: transform .28s ease;
      border-top-left-radius: 22px;
      border-top-right-radius: 22px;
      border-top: 1px solid rgba(180,195,255,0.14);
      background: rgba(10,11,16,0.92);
      box-shadow: 0 -18px 50px rgba(0,0,0,.65);
      overflow:hidden;
    }
    .sheet-backdrop.is-open .sheet{ transform: translateY(0); }
    .sheet-head{
      padding:12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom: 1px solid rgba(180,195,255,0.10);
      background: rgba(15,18,32,0.55);
    }
    .sheet-title{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:950;
      letter-spacing:.35px;
      font-size:14px;
      min-width:0;
    }
    .sheet-pill{
      font-size:11px;
      font-weight:950;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,43,214,.30);
      background: rgba(255,43,214,.10);
      color: var(--text);
      letter-spacing:.3px;
      white-space:nowrap;
    }
    .sheet-close{
      border:1px solid rgba(180,195,255,0.14);
      background: rgba(10,11,16,0.45);
      color: var(--text);
      font-weight:950;
      border-radius: 999px;
      padding:8px 10px;
      cursor:pointer;
      transition: transform .12s ease, border-color .2s ease, box-shadow .2s ease;
      flex:0 0 auto;
    }
    .sheet-close:hover{
      border-color: rgba(0,245,255,0.35);
      box-shadow: 0 0 0 1px rgba(0,245,255,0.14), 0 0 18px rgba(0,245,255,0.08);
      transform: translateY(-1px);
    }
    .sheet-body{
      padding:12px 14px 16px;
      overflow:auto;
      max-height: calc(78vh - 56px);
      -webkit-overflow-scrolling: touch;
    }
    .sheet-body::-webkit-scrollbar{width:10px}
    .sheet-body::-webkit-scrollbar-thumb{background: rgba(180,195,255,0.16); border-radius:999px}

    /* =========================
       COOKIE BANNER (with preferences)
    ========================== */
    .cookie-banner{
      position:fixed;
      left:0; right:0;
      bottom:0;
      z-index:1400;
      display:none;
      justify-content:center;
      padding: 10px 12px;
      pointer-events:none;
    }
    .cookie-banner.is-open{ display:flex; }

    .cookie-card{
      pointer-events:auto;
      width:min(var(--max), calc(100% - 16px));
      border-radius: 18px;
      border:1px solid rgba(180,195,255,0.14);
      background: rgba(10,11,16,0.92);
      backdrop-filter: blur(14px);
      box-shadow:
        0 18px 50px rgba(0,0,0,.65),
        0 0 0 1px rgba(0,245,255,0.08);
      overflow:hidden;
      position:relative;
    }
    .cookie-card:before{
      content:"";
      position:absolute; inset:0; pointer-events:none;
      background:
        radial-gradient(900px 220px at 10% 0%, rgba(0,245,255,.10), transparent 55%),
        radial-gradient(900px 220px at 95% 30%, rgba(255,43,214,.10), transparent 55%);
      opacity:.9;
    }
    .cookie-card > *{position:relative}

    .cookie-inner{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      padding: 12px 12px;
      border-bottom: 1px solid rgba(180,195,255,0.10);
    }
    .cookie-title{
      display:flex; align-items:center; gap:10px;
      font-weight:950;
      letter-spacing:.35px;
      font-size:13px;
      margin:0 0 6px;
    }
    .cookie-title .chip{
      width:10px;height:10px;border-radius:99px;
      background: var(--neon-cyan);
      box-shadow: 0 0 10px rgba(0,245,255,.35);
      display:inline-block;
    }
    .cookie-text{
      margin:0;
      color: var(--muted);
      font-size:12px;
      font-weight:650;
      line-height:1.45;
      max-width: 760px;
    }

    .cookie-actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex:0 0 auto;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .cookie-btn{
      border-radius: 999px;
      padding:8px 10px;
      font-size:12px;
      font-weight:950;
      letter-spacing:.25px;
      cursor:pointer;
      border:1px solid rgba(180,195,255,0.14);
      background: rgba(15,18,32,0.70);
      color: var(--text);
      transition: transform .12s ease, border-color .2s ease, box-shadow .2s ease;
      white-space:nowrap;
    }
    .cookie-btn:hover{
      transform: translateY(-1px);
      border-color: rgba(0,245,255,0.35);
      box-shadow: 0 0 0 1px rgba(0,245,255,0.14), 0 0 18px rgba(0,245,255,0.08);
    }
    .cookie-btn.accept{
      border-color: rgba(255,210,0,0.30);
      background: rgba(255,210,0,0.10);
      color: var(--neon-yellow);
    }
    .cookie-btn.reject{
      border-color: rgba(255,43,214,0.28);
      background: rgba(255,43,214,0.08);
      color: var(--text);
    }
    .cookie-btn.more{
      border-color: rgba(0,245,255,0.22);
      background: rgba(0,245,255,0.06);
      color: var(--neon-cyan);
    }

    .cookie-toggle{
      margin-top:10px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius: 999px;
      border:1px solid rgba(180,195,255,0.14);
      background: rgba(15,18,32,0.55);
      color: var(--text);
      font-weight:900;
      font-size:12px;
      letter-spacing:.25px;
      cursor:pointer;
      transition: transform .12s ease, border-color .2s ease, box-shadow .2s ease;
    }
    .cookie-toggle:hover{
      transform: translateY(-1px);
      border-color: rgba(0,245,255,0.35);
      box-shadow: 0 0 0 1px rgba(0,245,255,0.12), 0 0 18px rgba(0,245,255,0.07);
    }
    .cookie-toggle-mark{
      opacity:.9;
      color: var(--neon-cyan);
      font-weight:950;
    }

    .cookie-details{
      padding: 12px 12px 12px;
      border-top: 1px solid rgba(180,195,255,0.10);
      background: rgba(10,11,16,0.70);
    }
    .cookie-grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    .cookie-pref{
      border:1px solid rgba(180,195,255,0.12);
      border-radius: 14px;
      background: rgba(15,18,32,0.55);
      padding:10px 10px;
    }
    .cookie-pref-head{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .cookie-pref-title{
      font-weight:950;
      letter-spacing:.25px;
      font-size:13px;
      margin:0 0 4px;
    }
    .cookie-pref-desc{
      color: var(--muted);
      font-weight:650;
      font-size:12px;
      line-height:1.4;
    }
    .cookie-pill{
      font-size:11px;
      font-weight:950;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(180,195,255,0.12);
      background: rgba(10,11,16,0.45);
      color: var(--muted);
      white-space:nowrap;
      flex:0 0 auto;
    }
    .cookie-pill.always{
      border-color: rgba(255,210,0,0.28);
      background: rgba(255,210,0,0.08);
      color: var(--neon-yellow);
    }

    /* Switch */
    .switch{ position:relative; display:inline-block; width:44px; height:26px; flex:0 0 auto; }
    .switch input{ opacity:0; width:0; height:0; }
    .slider{
      position:absolute; inset:0;
      cursor:pointer;
      background: rgba(180,195,255,0.14);
      border:1px solid rgba(180,195,255,0.18);
      transition: .2s;
      border-radius: 999px;
      box-shadow: 0 0 0 1px rgba(0,0,0,0.18);
    }
    .slider:before{
      position:absolute; content:"";
      height:20px; width:20px;
      left:3px; top:50%;
      transform: translateY(-50%);
      background: rgba(232,236,255,0.92);
      transition: .2s;
      border-radius:999px;
      box-shadow: 0 0 12px rgba(0,245,255,0.10);
    }
    .switch input:checked + .slider{
      background: rgba(0,245,255,0.18);
      border-color: rgba(0,245,255,0.32);
      box-shadow: 0 0 0 1px rgba(0,245,255,0.12), 0 0 18px rgba(0,245,255,0.06);
    }
    .switch input:checked + .slider:before{
      transform: translateY(-50%) translateX(18px);
      background: rgba(0,245,255,0.92);
      box-shadow: 0 0 14px rgba(0,245,255,0.18);
    }

    .cookie-details-actions{
      margin-top:10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .cookie-bottom{
      margin-top:10px;
      padding: 10px 0 0;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      color: var(--muted-2);
      font-size:11px;
      font-weight:750;
      border-top: 1px solid rgba(180,195,255,0.10);
    }
    .cookie-bottom a{
      color: var(--neon-cyan);
      font-weight:900;
      border-bottom: 1px dashed rgba(0,245,255,0.35);
    }

    @media (max-width: 560px){
      .cookie-inner{flex-direction:column;}
      .cookie-actions{justify-content:flex-start;}
      .cookie-bottom{flex-direction:column;align-items:flex-start;}
      .cookie-details-actions{justify-content:flex-start;}
    }
  </style>
</head>

<body>
  <!-- =========================
       TOP NAVBAR (fixed)
  ========================== -->
  <header class="nav-wrap" id="nav">
    <div class="nav">
      <!-- LOGO + BRAND -->
      <a class="brand" href="https://darkfeed.online/" aria-label="Dark Feed Home">
        <!-- Consigliato: sostituisci con un asset locale, es. /assets/logo.jpg -->
        <img src="https://darkfeed.online/assets/logo.jpg" alt="Dark Feed logo" />
        <div>
          <div class="name"><span class="dot"></span> Dark Feed</div>
          <div class="sub">Analisi, segnali, fonti</div>
        </div>
      </a>

      <!-- CATEGORIE -->
      <nav class="cats" aria-label="Categorie">
        <button class="cat-btn is-active" data-cat="all" type="button"><span class="cat-pill tech"></span> Tutto</button>
        <button class="cat-btn" data-cat="geopolitica" type="button"><span class="cat-pill geo"></span> Geopolitica</button>
        <button class="cat-btn" data-cat="finanza" type="button"><span class="cat-pill fin"></span> Finanza</button>
        <button class="cat-btn" data-cat="tecnologia" type="button"><span class="cat-pill tech"></span> Tecnologia</button>
        <button class="cat-btn" data-cat="politica" type="button"><span class="cat-pill pol"></span> Politica</button>
      </nav>

      <!-- SEARCH + PATREON (desktop) -->
      <div class="nav-right">
        <div class="search" role="search">
          <span class="icon" aria-hidden="true">⌕</span>
          <input id="searchInput" type="search" placeholder="cerca nel feed" aria-label="Cerca nel feed" />
        </div>

        <!-- Sostituisci con il tuo URL Patreon reale se diverso -->
        <a class="patreon" href="https://www.patreon.com/" target="_blank" rel="noopener">
          <span class="p-dot" aria-hidden="true"></span>
          Patreon
        </a>
      </div>
    </div>
  </header>

  <!-- =========================
       MOBILE BOTTOM BAR (<=980px)
       - Patreon slim
  ========================== -->
  <div class="bottombar" id="bottomBar" aria-label="Barra inferiore">
    <div class="bottombar-inner">
      <a class="bb-patreon" href="https://www.patreon.com/" target="_blank" rel="noopener" aria-label="Supporta Dark Feed su Patreon">
        <span class="p-dot" aria-hidden="true"></span>
        Patreon
      </a>

      <div class="bb-actions">
        <button class="bb-btn" id="openFeatured" type="button" aria-label="Apri In evidenza">
          <span class="bb-dot yellow" aria-hidden="true"></span>
          In evidenza
        </button>
        <button class="bb-btn" id="openLive" type="button" aria-label="Apri Aggiornamenti Live">
          <span class="bb-dot cyan" aria-hidden="true"></span>
          Live
        </button>
      </div>
    </div>
  </div>

  <!-- =========================
       MOBILE BOTTOM SHEET (only <=980px)
  ========================== -->
  <div class="sheet-backdrop" id="sheetBackdrop" aria-hidden="true">
    <div class="sheet" role="dialog" aria-modal="true" aria-label="Pannello">
      <div class="sheet-head">
        <div class="sheet-title" id="sheetTitle"></div>
        <button class="sheet-close" id="sheetClose" type="button" aria-label="Chiudi pannello">Chiudi</button>
      </div>
      <div class="sheet-body" id="sheetBody"></div>
    </div>
  </div>

  <!-- =========================
       COOKIE BANNER (with preferences)
  ========================== -->
  <div class="cookie-banner" id="cookieBanner" aria-label="Banner cookie">
    <div class="cookie-card" role="dialog" aria-modal="true" aria-label="Preferenze cookie">
      <div class="cookie-inner">
        <div>
          <h3 class="cookie-title"><span class="chip" aria-hidden="true"></span> Cookie &amp; Privacy</h3>
          <p class="cookie-text">
            Usiamo cookie tecnici necessari al funzionamento del sito. Con il tuo consenso, possiamo usare cookie analitici e/o marketing.
            Puoi gestire le preferenze in dettaglio.
          </p>

          <button class="cookie-toggle" id="cookieToggleDetails" type="button" aria-expanded="false" aria-controls="cookieDetails">
            Mostra dettagli preferenze
            <span class="cookie-toggle-mark" aria-hidden="true">▾</span>
          </button>
        </div>

        <div class="cookie-actions" aria-label="Azioni cookie">
          <button class="cookie-btn reject" id="cookieRejectAll" type="button">Rifiuta</button>
          <button class="cookie-btn accept" id="cookieAcceptAll" type="button">Accetta</button>
        </div>
      </div>

      <div class="cookie-details" id="cookieDetails" hidden>
        <div class="cookie-grid" role="group" aria-label="Categorie cookie">
          <div class="cookie-pref">
            <div class="cookie-pref-head">
              <div>
                <div class="cookie-pref-title">Necessari</div>
                <div class="cookie-pref-desc">Funzioni base, sicurezza, UI. Sempre attivi.</div>
              </div>
              <div class="cookie-pill always">Sempre attivi</div>
            </div>
          </div>

          <div class="cookie-pref">
            <div class="cookie-pref-head">
              <div>
                <div class="cookie-pref-title">Analitici</div>
                <div class="cookie-pref-desc">Statistiche aggregate per migliorare performance e contenuti.</div>
              </div>
              <label class="switch" aria-label="Attiva cookie analitici">
                <input type="checkbox" id="cookieAnalytics" />
                <span class="slider"></span>
              </label>
            </div>
          </div>

          <div class="cookie-pref">
            <div class="cookie-pref-head">
              <div>
                <div class="cookie-pref-title">Marketing</div>
                <div class="cookie-pref-desc">Personalizzazione e contenuti promozionali. Opzionali.</div>
              </div>
              <label class="switch" aria-label="Attiva cookie marketing">
                <input type="checkbox" id="cookieMarketing" />
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </div>

        <div class="cookie-details-actions">
          <button class="cookie-btn more" id="cookieSavePrefs" type="button">Salva preferenze</button>
          <button class="cookie-btn" id="cookieCloseBanner" type="button">Chiudi</button>
        </div>

        <div class="cookie-bottom">
          <span>Preferenze salvate sul dispositivo (localStorage).</span>
          <span>
            <a href="https://darkfeed.online/cookie.html" id="cookiePolicyLink">Cookie Policy</a> ·
            <a href="https://darkfeed.online/privacy.html" id="privacyPolicyLink">Privacy</a> ·
            <a href="#" id="cookieManageLink">Gestisci cookie</a>
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- =========================
       PAGE
  ========================== -->
  <main class="page">
    <div class="status" id="statusBanner" role="status" aria-live="polite"></div>

    <section class="breaking" aria-label="Ultimo minuto">
      <div class="breaking-head">
        <div class="breaking-title"><span class="pulse" aria-hidden="true"></span>Scenari in evoluzione</div>
        <div class="breaking-hint"></div>
      </div>
      <div class="breaking-rail" id="breakingRail"></div>
    </section>

    <section class="main">
      <!-- FEED -->
      <div class="feed" id="feed"></div>

      <!-- DESKTOP SIDEBAR -->
      <aside class="sidebar" aria-label="In evidenza e aggiornamenti">
        <div class="side-card">
          <div class="side-head">
            <h3>In evidenza</h3>
            <span class="side-badge">Pinned</span>
          </div>
          <div class="featured-list" id="featuredList"></div>
        </div>

        <div class="side-card">
          <div class="side-head">
            <h3>Aggiornamenti ultimo minuto</h3>
            <span class="side-badge">Live</span>
          </div>
          <div class="featured-list updates" id="updatesList"></div>
        </div>
      </aside>
    </section>

    <!-- =========================
         FOOTER
    ========================== -->
    <footer class="site-footer" aria-label="Footer sito">
      <div class="footer-inner">
        <div class="footer-block">
          <h4>Dark Feed</h4>
          <p>
            Analisi e approfondimenti geopolitici, finanziari, tecnologici e politici. Aggiornamenti rapidi quando lo scenario evolve.
          </p>
        </div>

        <div class="footer-block">
          <h4>Link</h4>
          <div class="footer-links">
            <a href="https://darkfeed.online/about.html" id="footerAbout">Chi siamo</a>
            <a href="https://darkfeed.online/contacts.html" id="footerContacts">Contatti</a>
            <a href="https://www.patreon.com/" target="_blank" rel="noopener" aria-label="Patreon">Supporta su Patreon</a>
          </div>
        </div>

        <div class="footer-block">
          <h4>Policy</h4>
          <div class="footer-links">
            <a href="https://darkfeed.online/privacy.html" id="footerPrivacy">Privacy Policy</a>
            <a href="https://darkfeed.online/cookie.html" id="footerCookie">Cookie Policy</a>
            <a href="#" id="footerManageCookies">Gestisci cookie</a>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <span>© <span id="year"></span> Dark Feed (darkfeed.online) — Tutti i diritti riservati.</span>
        <div class="footer-badges" aria-label="Badge">
          <span class="footer-badge"></span>
          <span class="footer-badge"></span>
          <span class="footer-badge"></span>
        </div>
      </div>
    </footer>
  </main>

  <!-- =========================
       JAVASCRIPT
  ========================== -->
  <script>
    "use strict";

    /* =========================
       CONFIG: DOMAIN + PATHS
    ========================== */
    const SITE_ORIGIN = "https://darkfeed.online";
    const DATA_PATHS = {
      breaking: `${SITE_ORIGIN}/breaking.json`,
      articles: `${SITE_ORIGIN}/articles.json`,
      updates: `${SITE_ORIGIN}/updates.json`
    };

    /* =========================
       COOKIE SETTINGS STORAGE
    ========================== */
    const COOKIE_KEY = "darkfeed_cookie_prefs";
    // shape: { necessary: true, analytics: boolean, marketing: boolean, ts: ISOString }

    /* =========================
       APP STATE
    ========================== */
    let BREAKING_NEWS = [];
    let ARTICLES = [];
    let LIVE_UPDATES = [];

    let activeCategory = "all";
    let searchQuery = "";

    /* =========================
       HELPERS
    ========================== */
    function $(id){ return document.getElementById(id); }

    function escapeHtml(str){
      return String(str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function formatDateIT(dateISO){
      if (!dateISO) return "";
      const d = new Date(dateISO + "T00:00:00");
      if (Number.isNaN(d.getTime())) return escapeHtml(dateISO);
      const dd = String(d.getDate()).padStart(2,"0");
      const mm = String(d.getMonth()+1).padStart(2,"0");
      const yy = d.getFullYear();
      return `${dd}/${mm}/${yy}`;
    }

    function categoryClass(cat){
      if (cat === "geopolitica") return "geo";
      if (cat === "finanza") return "fin";
      if (cat === "tecnologia") return "tech";
      if (cat === "politica") return "pol";
      return "";
    }

    function topicLabel(topic){
      if (!topic) return "";
      return topic.charAt(0).toUpperCase() + topic.slice(1);
    }

    function showStatus(msg){
      const el = $("statusBanner");
      el.textContent = msg;
      el.style.display = "block";
    }
    function clearStatus(){
      const el = $("statusBanner");
      el.textContent = "";
      el.style.display = "none";
    }

    function isMobileMode(){
      return window.matchMedia("(max-width: 980px)").matches;
    }

    /* =========================
       LOAD JSON (cache-busting)
    ========================== */
    async function loadJson(url){
      const bust = `cb=${Date.now()}`;
      const sep = url.includes("?") ? "&" : "?";
      const res = await fetch(url + sep + bust, { cache: "no-store" });
      if (!res.ok) throw new Error(`HTTP ${res.status} su ${url}`);
      return res.json();
    }

    async function loadAllData(){
      clearStatus();
      try{
        const [breaking, articles, updates] = await Promise.all([
          loadJson(DATA_PATHS.breaking),
          loadJson(DATA_PATHS.articles),
          loadJson(DATA_PATHS.updates)
        ]);

        BREAKING_NEWS = Array.isArray(breaking) ? breaking : [];
        ARTICLES = Array.isArray(articles) ? articles : [];
        LIVE_UPDATES = Array.isArray(updates) ? updates : [];

        renderAll();
      } catch (e){
        console.error(e);
        showStatus("Impossibile caricare i file JSON. Verifica breaking.json, articles.json, updates.json e che siano pubblicati su darkfeed.online.");
        BREAKING_NEWS = [];
        ARTICLES = [];
        LIVE_UPDATES = [];
        renderAll();
      }
    }

    /* =========================
       RENDER: BREAKING
    ========================== */
    function renderBreaking(){
      const rail = $("breakingRail");
      if (!BREAKING_NEWS.length){
        rail.innerHTML = `
          <div class="breaking-item" role="article" aria-label="Notizia ultimo minuto">
            <div class="breaking-time">—</div>
            <div class="breaking-text">Nessun aggiornamento disponibile.</div>
          </div>
        `;
        return;
      }
      rail.innerHTML = BREAKING_NEWS.map(n => `
        <div class="breaking-item" role="article" aria-label="Notizia ultimo minuto">
          <div class="breaking-time">${escapeHtml(n.time)}</div>
          <div class="breaking-text">${escapeHtml(n.text)}</div>
        </div>
      `).join("");
    }

    /* =========================
       RENDER: FEED
    ========================== */
    function renderFeed(){
      const feed = $("feed");

      const filtered = ARTICLES
        .filter(a => activeCategory === "all" ? true : a.category === activeCategory)
        .filter(a => !searchQuery.trim() ? true : String(a.title || "").toLowerCase().includes(searchQuery.toLowerCase()))
        .slice()
        .sort((a,b) => new Date(b.dateISO) - new Date(a.dateISO));

      if (!filtered.length){
        feed.innerHTML = `
          <article class="card">
            <header class="card-head">
              <div class="meta-left">
                <h2 class="title">Nessun articolo trovato</h2>
                <p class="sub">Prova a cambiare categoria o ricerca.</p>
                <div class="tags"><span class="tag tech"><span class="mini"></span> Feed</span></div>
              </div>
              <div class="meta-right">—</div>
            </header>
            <div class="card-body">
              <p class="body">Aggiorna <strong>articles.json</strong> per inserire nuovi contenuti.</p>
            </div>
          </article>
        `;
        return;
      }

      feed.innerHTML = filtered.map(articleCardHTML).join("");
    }

    function articleCardHTML(a){
      const tagCls = categoryClass(a.category);
      const tagLabel = a.category ? (a.category.charAt(0).toUpperCase() + a.category.slice(1)) : "Altro";

      const mediaHTML = (() => {
        if (!a.media || a.media.type === "none") return "";
        if (a.media.type === "image" && a.media.src){
          return `
            <div class="media">
              <img src="${escapeHtml(a.media.src)}" alt="${escapeHtml(a.media.alt || a.title)}" loading="lazy" />
            </div>
          `;
        }
        if (a.media.type === "youtube" && a.media.youtubeId){
          const id = encodeURIComponent(a.media.youtubeId);
          return `
            <div class="media">
              <div class="yt" aria-label="Video YouTube incorporato">
                <iframe
                  src="https://www.youtube-nocookie.com/embed/${id}"
                  title="${escapeHtml(a.title)}"
                  loading="lazy"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                  allowfullscreen>
                </iframe>
              </div>
            </div>
          `;
        }
        return "";
      })();

      const sourcesHTML = Array.isArray(a.sources) ? a.sources.map(s => `
        <a class="source" href="${escapeHtml(s.url)}" target="_blank" rel="noopener">
          ${escapeHtml(s.label)}
        </a>
      `).join("") : "";

      const bodyHTML = escapeHtml(a.body || "").replaceAll("\n","<br><br>");

      return `
        <article class="card" id="${escapeHtml(a.id || "")}">
          <header class="card-head">
            <div class="meta-left">
              <h2 class="title">${escapeHtml(a.title || "")}</h2>
              <p class="sub">${escapeHtml(a.subtitle || "")}</p>
              <div class="tags" aria-label="Tag articolo">
                <span class="tag ${tagCls}">
                  <span class="mini" aria-hidden="true"></span>
                  ${escapeHtml(tagLabel)}
                </span>
              </div>
            </div>
            <div class="meta-right">${escapeHtml(formatDateIT(a.dateISO))}</div>
          </header>

          ${mediaHTML}

          <div class="card-body">
            <p class="body">${bodyHTML}</p>

            ${a.highlight ? `
              <div class="quote">
                <div class="label">In evidenza</div>
                <p class="text">${escapeHtml(a.highlight)}</p>
              </div>
            ` : ""}

            ${sourcesHTML ? `
              <div class="sources" aria-label="Fonti">
                ${sourcesHTML}
              </div>
            ` : ""}
          </div>
        </article>
      `;
    }

    /* =========================
       RENDER: DESKTOP SIDEBAR
    ========================== */
    function renderFeaturedDesktop(){
      const featuredList = $("featuredList");
      const featured = ARTICLES
        .filter(a => !!a.featured)
        .slice()
        .sort((a,b) => new Date(b.dateISO) - new Date(a.dateISO));

      if (!featured.length){
        featuredList.innerHTML = `
          <div class="feat-item" role="button" tabindex="0" aria-label="Nessun pinned">
            <img class="feat-thumb" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='160'%3E%3Crect width='240' height='160' fill='%23101422'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%23a7b0d6' font-family='Arial' font-size='14'%3ENessun%20Pinned%3C/text%3E%3C/svg%3E" alt="" />
            <div class="feat-meta">
              <p class="feat-title">Nessun pinned</p>
              <p class="feat-sub">Imposta "featured": true in articles.json</p>
            </div>
          </div>
        `;
        return;
      }

      featuredList.innerHTML = featured.map(featuredItemHTML).join("");

      featuredList.querySelectorAll("[data-jump]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-jump");
          const el = document.getElementById(id);
          if (el) el.scrollIntoView({ behavior: "smooth", block: "start" });
        });
        btn.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") { e.preventDefault(); btn.click(); }
        });
      });
    }

    function featuredItemHTML(a){
      const thumb = a.thumb || (a.media && a.media.type === "image" ? a.media.src : "");
      const safeThumb = thumb
        ? escapeHtml(thumb)
        : "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='160'%3E%3Crect width='240' height='160' fill='%23101422'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%23a7b0d6' font-family='Arial' font-size='14'%3EDark%20Feed%3C/text%3E%3C/svg%3E";

      return `
        <div class="feat-item" data-jump="${escapeHtml(a.id || "")}" role="button" tabindex="0" aria-label="Vai all'articolo in evidenza">
          <img class="feat-thumb" src="${safeThumb}" alt="" loading="lazy" />
          <div class="feat-meta">
            <p class="feat-title">${escapeHtml(a.title || "")}</p>
            <p class="feat-sub">${escapeHtml(a.subtitle || "")}</p>
          </div>
        </div>
      `;
    }

    function renderUpdatesDesktop(){
      const list = $("updatesList");

      if (!LIVE_UPDATES.length){
        list.innerHTML = `
          <div class="update-item" role="article" aria-label="Aggiornamento live">
            <div class="update-head">
              <div class="update-user">
                <div class="avatar" aria-hidden="true" style="background:rgba(0,245,255,.10)"></div>
                <div class="handle"><span style="color:var(--neon-cyan);font-weight:950">@DarkFeed</span></div>
              </div>
              <div class="update-time">—</div>
            </div>
            <p class="update-text">Nessun aggiornamento live al momento.</p>
            <div class="update-tags"><span class="mini-chip live">LIVE</span></div>
          </div>
        `;
        return;
      }

      const sorted = LIVE_UPDATES.slice().sort((a,b) => {
        const at = a.ts ? new Date(a.ts).getTime() : NaN;
        const bt = b.ts ? new Date(b.ts).getTime() : NaN;
        if (!Number.isNaN(at) && !Number.isNaN(bt)) return bt - at;
        return 0;
      });

      list.innerHTML = sorted.map(updateItemHTML).join("");
    }

    function updateItemHTML(u){
      const avatar = u.avatar
        ? `<img class="avatar" src="${escapeHtml(u.avatar)}" alt="" loading="lazy" />`
        : `<div class="avatar" aria-hidden="true" style="background:rgba(0,245,255,.10)"></div>`;

      const handle = escapeHtml(u.handle || "@team");
      const xUrl = escapeHtml(u.xUrl || "https://x.com/");
      const time = escapeHtml(u.time || (u.ts ? new Date(u.ts).toLocaleString("it-IT", { hour:"2-digit", minute:"2-digit" }) : ""));

      const topic = u.topic ? `
        <div class="update-tags">
          <span class="mini-chip live">LIVE</span>
          <span class="mini-chip">${escapeHtml(topicLabel(u.topic))}</span>
        </div>
      ` : `<div class="update-tags"><span class="mini-chip live">LIVE</span></div>`;

      return `
        <div class="update-item" id="${escapeHtml(u.id || "")}" role="article" aria-label="Aggiornamento live">
          <div class="update-head">
            <div class="update-user">
              ${avatar}
              <div class="handle"><a href="${xUrl}" target="_blank" rel="noopener">${handle}</a></div>
            </div>
            <div class="update-time">${time}</div>
          </div>
          <p class="update-text">${escapeHtml(u.text || "")}</p>
          ${topic}
        </div>
      `;
    }

    /* =========================
       MOBILE SHEET CONTENT
    ========================== */
    function buildFeaturedHTML(){
      const featured = ARTICLES.filter(a => !!a.featured).slice().sort((a,b) => new Date(b.dateISO) - new Date(a.dateISO));
      if (!featured.length){
        return `
          <div class="featured-list" style="padding:0;">
            <div class="feat-item" role="button" tabindex="0" aria-label="Nessun pinned">
              <img class="feat-thumb" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='160'%3E%3Crect width='240' height='160' fill='%23101422'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%23a7b0d6' font-family='Arial' font-size='14'%3ENessun%20Pinned%3C/text%3E%3C/svg%3E" alt="" />
              <div class="feat-meta">
                <p class="feat-title">Nessun articolo in evidenza</p>
                <p class="feat-sub">Imposta "featured": true in articles.json</p>
              </div>
            </div>
          </div>
        `;
      }

      return `
        <div class="featured-list" style="padding:0;">
          ${featured.map(featuredItemHTML).join("")}
        </div>
      `;
    }

    function buildLiveHTML(){
      if (!LIVE_UPDATES.length){
        return `
          <div class="updates">
            <div class="update-item">
              <div class="update-head">
                <div class="update-user">
                  <div class="avatar" aria-hidden="true" style="background:rgba(0,245,255,.10)"></div>
                  <div class="handle"><span style="color:var(--neon-cyan);font-weight:950">@DarkFeed</span></div>
                </div>
                <div class="update-time">—</div>
              </div>
              <p class="update-text">Nessun aggiornamento live al momento.</p>
              <div class="update-tags"><span class="mini-chip live">LIVE</span></div>
            </div>
          </div>
        `;
      }

      const sorted = LIVE_UPDATES.slice().sort((a,b) => {
        const at = a.ts ? new Date(a.ts).getTime() : NaN;
        const bt = b.ts ? new Date(b.ts).getTime() : NaN;
        if (!Number.isNaN(at) && !Number.isNaN(bt)) return bt - at;
        return 0;
      });

      return `<div class="updates">${sorted.map(updateItemHTML).join("")}</div>`;
    }

    /* =========================
       MOBILE SHEET OPEN/CLOSE
    ========================== */
    function openSheet(mode){
      if (!isMobileMode()) return;

      const backdrop = $("sheetBackdrop");
      const body = $("sheetBody");
      const title = $("sheetTitle");

      if (mode === "featured"){
        title.innerHTML = `
          <span class="bb-dot yellow" aria-hidden="true"></span>
          <span style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">In evidenza</span>
          <span class="sheet-pill">Pinned</span>
        `;
        body.innerHTML = buildFeaturedHTML();

        body.querySelectorAll("[data-jump]").forEach(btn => {
          btn.addEventListener("click", () => {
            const id = btn.getAttribute("data-jump");
            closeSheet();
            const el = document.getElementById(id);
            if (el) el.scrollIntoView({ behavior: "smooth", block: "start" });
          });
          btn.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") { e.preventDefault(); btn.click(); }
          });
        });
      } else {
        title.innerHTML = `
          <span class="bb-dot cyan" aria-hidden="true"></span>
          <span style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Aggiornamenti ultimo minuto</span>
          <span class="sheet-pill">Live</span>
        `;
        body.innerHTML = buildLiveHTML();
      }

      backdrop.classList.add("is-open");
      backdrop.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
    }

    function closeSheet(){
      const backdrop = $("sheetBackdrop");
      backdrop.classList.remove("is-open");
      backdrop.setAttribute("aria-hidden","true");
      document.body.style.overflow = "";
    }

    function setupSheetUI(){
      $("openFeatured").addEventListener("click", () => openSheet("featured"));
      $("openLive").addEventListener("click", () => openSheet("live"));
      $("sheetClose").addEventListener("click", closeSheet);

      $("sheetBackdrop").addEventListener("click", (e) => {
        if (e.target.id === "sheetBackdrop") closeSheet();
      });

      window.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeSheet();
      });

      window.addEventListener("resize", () => {
        if (!isMobileMode()) closeSheet();
      });
    }

    /* =========================
       UI: FILTERS
    ========================== */
    function setupFilters(){
      document.querySelectorAll(".cat-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll(".cat-btn").forEach(b => b.classList.remove("is-active"));
          btn.classList.add("is-active");
          activeCategory = btn.getAttribute("data-cat") || "all";
          renderFeed();
        });
      });

      const search = $("searchInput");
      if (search){
        search.addEventListener("input", (e) => {
          searchQuery = e.target.value || "";
          renderFeed();
        });
      }
    }

    /* =========================
       TOP NAVBAR SCROLL LOGIC
    ========================== */
    function setupTopNavbarScroll(){
      const nav = $("nav");
      let lastY = window.scrollY;
      let downAccum = 0;

      const SCROLL_SCROLLED_AT = 12;
      const HIDE_AFTER_DOWN_PX = 160;

      window.addEventListener("scroll", () => {
        const y = window.scrollY;

        if (y > SCROLL_SCROLLED_AT) nav.classList.add("is-scrolled");
        else nav.classList.remove("is-scrolled");

        const delta = y - lastY;

        if (delta > 0){
          downAccum += delta;
          if (downAccum > HIDE_AFTER_DOWN_PX) nav.classList.add("is-hidden");
        } else if (delta < 0){
          downAccum = 0;
          nav.classList.remove("is-hidden");
        }

        lastY = y;
      }, { passive:true });
    }

    /* =========================
       BOTTOM BAR SCROLL LOGIC (ONLY MOBILE)
    ========================== */
    function setupBottomBarScroll(){
      const bar = $("bottomBar");
      let lastY = window.scrollY;
      let downAccum = 0;

      const SHOW_AFTER_DOWN_PX = 120;
      const HIDE_ON_UP_THRESHOLD = 8;

      window.addEventListener("scroll", () => {
        if (!isMobileMode()){
          bar.classList.remove("is-visible");
          return;
        }

        const y = window.scrollY;
        const delta = y - lastY;

        if (delta > 0){
          downAccum += delta;
          if (downAccum > SHOW_AFTER_DOWN_PX) bar.classList.add("is-visible");
        } else if (delta < 0){
          if (Math.abs(delta) > HIDE_ON_UP_THRESHOLD) bar.classList.remove("is-visible");
          downAccum = 0;
        }

        if (y < 60) bar.classList.remove("is-visible");
        lastY = y;
      }, { passive:true });

      window.addEventListener("resize", () => {
        if (!isMobileMode()) bar.classList.remove("is-visible");
      });
    }

    /* =========================
       COOKIE BANNER + PREFERENCES
    ========================== */
    function setCookieSafeSpacing(){
      const banner = $("cookieBanner");
      const open = banner.classList.contains("is-open");

      if (!open){
        document.documentElement.style.setProperty("--cookie-safe", "0px");
        return;
      }

      const safe = window.matchMedia("(max-width: 560px)").matches ? 170 : 120;
      document.documentElement.style.setProperty("--cookie-safe", safe + "px");
    }

    function getStoredCookiePrefs(){
      try{
        const raw = localStorage.getItem(COOKIE_KEY);
        if (!raw) return null;
        const obj = JSON.parse(raw);
        if (!obj || typeof obj !== "object") return null;
        return {
          necessary: true,
          analytics: !!obj.analytics,
          marketing: !!obj.marketing,
          ts: obj.ts || new Date().toISOString()
        };
      } catch {
        return null;
      }
    }

    function storeCookiePrefs(prefs){
      localStorage.setItem(COOKIE_KEY, JSON.stringify({
        necessary: true,
        analytics: !!prefs.analytics,
        marketing: !!prefs.marketing,
        ts: new Date().toISOString()
      }));
    }

    function openCookieBanner(){
      const banner = $("cookieBanner");
      banner.classList.add("is-open");
      setCookieSafeSpacing();
    }

    function closeCookieBanner(){
      const banner = $("cookieBanner");
      banner.classList.remove("is-open");
      setCookieSafeSpacing();
    }

    function setDetailsOpen(isOpen){
      const details = $("cookieDetails");
      const btn = $("cookieToggleDetails");
      const mark = btn.querySelector(".cookie-toggle-mark");

      if (isOpen){
        details.hidden = false;
        btn.setAttribute("aria-expanded","true");
        btn.firstChild.textContent = "Nascondi dettagli preferenze ";
        if (mark) mark.textContent = "▴";
      } else {
        details.hidden = true;
        btn.setAttribute("aria-expanded","false");
        btn.firstChild.textContent = "Mostra dettagli preferenze ";
        if (mark) mark.textContent = "▾";
      }

      setCookieSafeSpacing();
    }

    function applyPrefsToUI(prefs){
      $("cookieAnalytics").checked = !!prefs.analytics;
      $("cookieMarketing").checked = !!prefs.marketing;
    }

    function setupCookieBanner(){
      const stored = getStoredCookiePrefs();
      const analyticsEl = $("cookieAnalytics");
      const marketingEl = $("cookieMarketing");

      if (!stored){
        applyPrefsToUI({ analytics:false, marketing:false });
        openCookieBanner();
      } else {
        applyPrefsToUI(stored);
        closeCookieBanner();
      }

      $("cookieToggleDetails").addEventListener("click", () => {
        const details = $("cookieDetails");
        setDetailsOpen(details.hidden);
      });

      $("cookieAcceptAll").addEventListener("click", () => {
        storeCookiePrefs({ analytics:true, marketing:true });
        closeCookieBanner();
      });

      $("cookieRejectAll").addEventListener("click", () => {
        storeCookiePrefs({ analytics:false, marketing:false });
        closeCookieBanner();
      });

      $("cookieSavePrefs").addEventListener("click", () => {
        storeCookiePrefs({ analytics: analyticsEl.checked, marketing: marketingEl.checked });
        closeCookieBanner();
      });

      $("cookieCloseBanner").addEventListener("click", () => {
        const now = getStoredCookiePrefs();
        if (!now){
          storeCookiePrefs({ analytics:false, marketing:false });
        }
        closeCookieBanner();
      });

      function openManage(){
        const prefs = getStoredCookiePrefs() || { analytics:false, marketing:false };
        applyPrefsToUI(prefs);
        openCookieBanner();
        setDetailsOpen(true);
      }

      $("cookieManageLink").addEventListener("click", (e) => { e.preventDefault(); openManage(); });
      $("footerManageCookies").addEventListener("click", (e) => { e.preventDefault(); openManage(); });

      window.addEventListener("resize", setCookieSafeSpacing);
    }

    function renderAll(){
      renderBreaking();
      renderFeed();
      renderFeaturedDesktop();
      renderUpdatesDesktop();
    }

    /* =========================
       INIT
    ========================== */
    $("year").textContent = new Date().getFullYear();
    setupFilters();
    setupTopNavbarScroll();
    setupBottomBarScroll();
    setupSheetUI();
    setupCookieBanner();
    loadAllData();
  </script>
</body>
</html>







